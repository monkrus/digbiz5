168741f53c00cbf323d432422b5b78bf
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var ReactNativeFeatureFlags = _interopRequireWildcard(require("../../src/private/featureflags/ReactNativeFeatureFlags"));
var _EventEmitter = _interopRequireDefault(require("../vendor/emitter/EventEmitter"));
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function _interopRequireWildcard(e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (var _t in e) "default" !== _t && {}.hasOwnProperty.call(e, _t) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, _t)) && (i.get || i.set) ? o(f, _t, i) : f[_t] = e[_t]); return f; })(e, t); }
var BatchedBridge = require('../BatchedBridge/BatchedBridge').default;
var TaskQueue = require('./TaskQueue').default;
var invariant = require('invariant');
var _emitter = new _EventEmitter.default();
var DEBUG_DELAY = 0;
var DEBUG = false;
var InteractionManagerImpl = {
  Events: {
    interactionStart: 'interactionStart',
    interactionComplete: 'interactionComplete'
  },
  runAfterInteractions: function runAfterInteractions(task) {
    var tasks = [];
    var promise = new Promise(function (resolve) {
      _scheduleUpdate();
      if (task) {
        tasks.push(task);
      }
      tasks.push({
        run: resolve,
        name: 'resolve ' + (task && task.name || '?')
      });
      _taskQueue.enqueueTasks(tasks);
    });
    return {
      then: promise.then.bind(promise),
      cancel: function cancel() {
        _taskQueue.cancelTasks(tasks);
      }
    };
  },
  createInteractionHandle: function createInteractionHandle() {
    DEBUG && console.log('InteractionManager: create interaction handle');
    _scheduleUpdate();
    var handle = ++_inc;
    _addInteractionSet.add(handle);
    return handle;
  },
  clearInteractionHandle: function clearInteractionHandle(handle) {
    DEBUG && console.log('InteractionManager: clear interaction handle');
    invariant(!!handle, 'InteractionManager: Must provide a handle to clear.');
    _scheduleUpdate();
    _addInteractionSet.delete(handle);
    _deleteInteractionSet.add(handle);
  },
  addListener: _emitter.addListener.bind(_emitter),
  setDeadline: function setDeadline(deadline) {
    _deadline = deadline;
  }
};
var _interactionSet = new Set();
var _addInteractionSet = new Set();
var _deleteInteractionSet = new Set();
var _taskQueue = new TaskQueue({
  onMoreTasks: _scheduleUpdate
});
var _nextUpdateHandle = 0;
var _inc = 0;
var _deadline = -1;
function _scheduleUpdate() {
  if (!_nextUpdateHandle) {
    if (_deadline > 0) {
      _nextUpdateHandle = setTimeout(_processUpdate, 0 + DEBUG_DELAY);
    } else {
      _nextUpdateHandle = setImmediate(_processUpdate);
    }
  }
}
function _processUpdate() {
  _nextUpdateHandle = 0;
  var interactionCount = _interactionSet.size;
  _addInteractionSet.forEach(function (handle) {
    return _interactionSet.add(handle);
  });
  _deleteInteractionSet.forEach(function (handle) {
    return _interactionSet.delete(handle);
  });
  var nextInteractionCount = _interactionSet.size;
  if (interactionCount !== 0 && nextInteractionCount === 0) {
    _emitter.emit(InteractionManager.Events.interactionComplete);
  } else if (interactionCount === 0 && nextInteractionCount !== 0) {
    _emitter.emit(InteractionManager.Events.interactionStart);
  }
  if (nextInteractionCount === 0) {
    while (_taskQueue.hasTasksToProcess()) {
      _taskQueue.processNext();
      if (_deadline > 0 && BatchedBridge.getEventLoopRunningTime() >= _deadline) {
        _scheduleUpdate();
        break;
      }
    }
  }
  _addInteractionSet.clear();
  _deleteInteractionSet.clear();
}
var InteractionManager = ReactNativeFeatureFlags.disableInteractionManager() ? require('./InteractionManagerStub').default : InteractionManagerImpl;
var _default = exports.default = InteractionManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJSZWFjdE5hdGl2ZUZlYXR1cmVGbGFncyIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwicmVxdWlyZSIsIl9FdmVudEVtaXR0ZXIiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiZSIsInQiLCJXZWFrTWFwIiwiciIsIm4iLCJfX2VzTW9kdWxlIiwibyIsImkiLCJmIiwiX19wcm90b19fIiwiZGVmYXVsdCIsImhhcyIsImdldCIsInNldCIsIl90IiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJCYXRjaGVkQnJpZGdlIiwiVGFza1F1ZXVlIiwiaW52YXJpYW50IiwiX2VtaXR0ZXIiLCJFdmVudEVtaXR0ZXIiLCJERUJVR19ERUxBWSIsIkRFQlVHIiwiSW50ZXJhY3Rpb25NYW5hZ2VySW1wbCIsIkV2ZW50cyIsImludGVyYWN0aW9uU3RhcnQiLCJpbnRlcmFjdGlvbkNvbXBsZXRlIiwicnVuQWZ0ZXJJbnRlcmFjdGlvbnMiLCJ0YXNrIiwidGFza3MiLCJwcm9taXNlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJfc2NoZWR1bGVVcGRhdGUiLCJwdXNoIiwicnVuIiwibmFtZSIsIl90YXNrUXVldWUiLCJlbnF1ZXVlVGFza3MiLCJ0aGVuIiwiYmluZCIsImNhbmNlbCIsImNhbmNlbFRhc2tzIiwiY3JlYXRlSW50ZXJhY3Rpb25IYW5kbGUiLCJjb25zb2xlIiwibG9nIiwiaGFuZGxlIiwiX2luYyIsIl9hZGRJbnRlcmFjdGlvblNldCIsImFkZCIsImNsZWFySW50ZXJhY3Rpb25IYW5kbGUiLCJkZWxldGUiLCJfZGVsZXRlSW50ZXJhY3Rpb25TZXQiLCJhZGRMaXN0ZW5lciIsInNldERlYWRsaW5lIiwiZGVhZGxpbmUiLCJfZGVhZGxpbmUiLCJfaW50ZXJhY3Rpb25TZXQiLCJTZXQiLCJvbk1vcmVUYXNrcyIsIl9uZXh0VXBkYXRlSGFuZGxlIiwic2V0VGltZW91dCIsIl9wcm9jZXNzVXBkYXRlIiwic2V0SW1tZWRpYXRlIiwiaW50ZXJhY3Rpb25Db3VudCIsInNpemUiLCJmb3JFYWNoIiwibmV4dEludGVyYWN0aW9uQ291bnQiLCJlbWl0IiwiSW50ZXJhY3Rpb25NYW5hZ2VyIiwiaGFzVGFza3NUb1Byb2Nlc3MiLCJwcm9jZXNzTmV4dCIsImdldEV2ZW50TG9vcFJ1bm5pbmdUaW1lIiwiY2xlYXIiLCJkaXNhYmxlSW50ZXJhY3Rpb25NYW5hZ2VyIiwiX2RlZmF1bHQiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsiSW50ZXJhY3Rpb25NYW5hZ2VyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSBNZXRhIFBsYXRmb3JtcywgSW5jLiBhbmQgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZmxvdyBzdHJpY3QtbG9jYWxcbiAqIEBmb3JtYXRcbiAqL1xuXG5pbXBvcnQgdHlwZSB7RXZlbnRTdWJzY3JpcHRpb259IGZyb20gJy4uL3ZlbmRvci9lbWl0dGVyL0V2ZW50RW1pdHRlcic7XG5pbXBvcnQgdHlwZSB7VGFza30gZnJvbSAnLi9UYXNrUXVldWUnO1xuXG5pbXBvcnQgKiBhcyBSZWFjdE5hdGl2ZUZlYXR1cmVGbGFncyBmcm9tICcuLi8uLi9zcmMvcHJpdmF0ZS9mZWF0dXJlZmxhZ3MvUmVhY3ROYXRpdmVGZWF0dXJlRmxhZ3MnO1xuaW1wb3J0IEV2ZW50RW1pdHRlciBmcm9tICcuLi92ZW5kb3IvZW1pdHRlci9FdmVudEVtaXR0ZXInO1xuXG5jb25zdCBCYXRjaGVkQnJpZGdlID0gcmVxdWlyZSgnLi4vQmF0Y2hlZEJyaWRnZS9CYXRjaGVkQnJpZGdlJykuZGVmYXVsdDtcbmNvbnN0IFRhc2tRdWV1ZSA9IHJlcXVpcmUoJy4vVGFza1F1ZXVlJykuZGVmYXVsdDtcbmNvbnN0IGludmFyaWFudCA9IHJlcXVpcmUoJ2ludmFyaWFudCcpO1xuXG5leHBvcnQgdHlwZSB7VGFzaywgU2ltcGxlVGFzaywgUHJvbWlzZVRhc2t9IGZyb20gJy4vVGFza1F1ZXVlJztcblxuZXhwb3J0IHR5cGUgSGFuZGxlID0gbnVtYmVyO1xuXG5jb25zdCBfZW1pdHRlciA9IG5ldyBFdmVudEVtaXR0ZXI8e1xuICBpbnRlcmFjdGlvbkNvbXBsZXRlOiBbXSxcbiAgaW50ZXJhY3Rpb25TdGFydDogW10sXG59PigpO1xuXG5jb25zdCBERUJVR19ERUxBWTogMCA9IDA7XG5jb25zdCBERUJVRzogZmFsc2UgPSBmYWxzZTtcblxuY29uc3QgSW50ZXJhY3Rpb25NYW5hZ2VySW1wbCA9IHtcbiAgRXZlbnRzOiB7XG4gICAgaW50ZXJhY3Rpb25TdGFydDogJ2ludGVyYWN0aW9uU3RhcnQnLFxuICAgIGludGVyYWN0aW9uQ29tcGxldGU6ICdpbnRlcmFjdGlvbkNvbXBsZXRlJyxcbiAgfSxcblxuICAvKipcbiAgICogU2NoZWR1bGUgYSBmdW5jdGlvbiB0byBydW4gYWZ0ZXIgYWxsIGludGVyYWN0aW9ucyBoYXZlIGNvbXBsZXRlZC4gUmV0dXJucyBhIGNhbmNlbGxhYmxlXG4gICAqIFwicHJvbWlzZVwiLlxuICAgKi9cbiAgcnVuQWZ0ZXJJbnRlcmFjdGlvbnModGFzazogP1Rhc2spOiB7XG4gICAgdGhlbjogPFU+KFxuICAgICAgb25GdWxmaWxsPzogPyh2b2lkKSA9PiA/KFByb21pc2U8VT4gfCBVKSxcbiAgICAgIG9uUmVqZWN0PzogPyhlcnJvcjogbWl4ZWQpID0+ID8oUHJvbWlzZTxVPiB8IFUpLFxuICAgICkgPT4gUHJvbWlzZTxVPixcbiAgICBjYW5jZWw6ICgpID0+IHZvaWQsXG4gICAgLi4uXG4gIH0ge1xuICAgIGNvbnN0IHRhc2tzOiBBcnJheTxUYXNrPiA9IFtdO1xuICAgIGNvbnN0IHByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZTogKCkgPT4gdm9pZCkgPT4ge1xuICAgICAgX3NjaGVkdWxlVXBkYXRlKCk7XG4gICAgICBpZiAodGFzaykge1xuICAgICAgICB0YXNrcy5wdXNoKHRhc2spO1xuICAgICAgfVxuICAgICAgdGFza3MucHVzaCh7XG4gICAgICAgIHJ1bjogcmVzb2x2ZSxcbiAgICAgICAgbmFtZTogJ3Jlc29sdmUgJyArICgodGFzayAmJiB0YXNrLm5hbWUpIHx8ICc/JyksXG4gICAgICB9KTtcbiAgICAgIF90YXNrUXVldWUuZW5xdWV1ZVRhc2tzKHRhc2tzKTtcbiAgICB9KTtcbiAgICByZXR1cm4ge1xuICAgICAgLy8gJEZsb3dGaXhNZVttZXRob2QtdW5iaW5kaW5nXSBhZGRlZCB3aGVuIGltcHJvdmluZyB0eXBpbmcgZm9yIHRoaXMgcGFyYW1ldGVyc1xuICAgICAgdGhlbjogcHJvbWlzZS50aGVuLmJpbmQocHJvbWlzZSksXG4gICAgICBjYW5jZWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgX3Rhc2tRdWV1ZS5jYW5jZWxUYXNrcyh0YXNrcyk7XG4gICAgICB9LFxuICAgIH07XG4gIH0sXG5cbiAgLyoqXG4gICAqIE5vdGlmeSBtYW5hZ2VyIHRoYXQgYW4gaW50ZXJhY3Rpb24gaGFzIHN0YXJ0ZWQuXG4gICAqL1xuICBjcmVhdGVJbnRlcmFjdGlvbkhhbmRsZSgpOiBIYW5kbGUge1xuICAgIERFQlVHICYmIGNvbnNvbGUubG9nKCdJbnRlcmFjdGlvbk1hbmFnZXI6IGNyZWF0ZSBpbnRlcmFjdGlvbiBoYW5kbGUnKTtcbiAgICBfc2NoZWR1bGVVcGRhdGUoKTtcbiAgICBjb25zdCBoYW5kbGUgPSArK19pbmM7XG4gICAgX2FkZEludGVyYWN0aW9uU2V0LmFkZChoYW5kbGUpO1xuICAgIHJldHVybiBoYW5kbGU7XG4gIH0sXG5cbiAgLyoqXG4gICAqIE5vdGlmeSBtYW5hZ2VyIHRoYXQgYW4gaW50ZXJhY3Rpb24gaGFzIGNvbXBsZXRlZC5cbiAgICovXG4gIGNsZWFySW50ZXJhY3Rpb25IYW5kbGUoaGFuZGxlOiBIYW5kbGUpIHtcbiAgICBERUJVRyAmJiBjb25zb2xlLmxvZygnSW50ZXJhY3Rpb25NYW5hZ2VyOiBjbGVhciBpbnRlcmFjdGlvbiBoYW5kbGUnKTtcbiAgICBpbnZhcmlhbnQoISFoYW5kbGUsICdJbnRlcmFjdGlvbk1hbmFnZXI6IE11c3QgcHJvdmlkZSBhIGhhbmRsZSB0byBjbGVhci4nKTtcbiAgICBfc2NoZWR1bGVVcGRhdGUoKTtcbiAgICBfYWRkSW50ZXJhY3Rpb25TZXQuZGVsZXRlKGhhbmRsZSk7XG4gICAgX2RlbGV0ZUludGVyYWN0aW9uU2V0LmFkZChoYW5kbGUpO1xuICB9LFxuXG4gIC8vICRGbG93Rml4TWVbdW5jbGVhci10eXBlXSB1bmNsZWFyIHR5cGUgb2YgX2VtaXR0ZXJcbiAgLy8gJEZsb3dGaXhNZVttZXRob2QtdW5iaW5kaW5nXSBhZGRlZCB3aGVuIGltcHJvdmluZyB0eXBpbmcgZm9yIHRoaXMgcGFyYW1ldGVyc1xuICBhZGRMaXN0ZW5lcjogX2VtaXR0ZXIuYWRkTGlzdGVuZXIuYmluZChfZW1pdHRlcikgYXMgKFxuICAgIGV2ZW50VHlwZTogc3RyaW5nLFxuICAgIC8vICRGbG93Rml4TWVbdW5jbGVhci10eXBlXSB1bmNsZWFyIHR5cGUgb2YgYXJndW1lbnRzXG4gICAgbGlzdGVuZXI6ICguLi5hcmdzOiBhbnkpID0+IG1peGVkLFxuICAgIGNvbnRleHQ6IG1peGVkLFxuICApID0+IEV2ZW50U3Vic2NyaXB0aW9uLFxuXG4gIC8qKlxuICAgKiBBIHBvc2l0aXZlIG51bWJlciB3aWxsIHVzZSBzZXRUaW1lb3V0IHRvIHNjaGVkdWxlIGFueSB0YXNrcyBhZnRlciB0aGVcbiAgICogZXZlbnRMb29wUnVubmluZ1RpbWUgaGl0cyB0aGUgZGVhZGxpbmUgdmFsdWUsIG90aGVyd2lzZSBhbGwgdGFza3Mgd2lsbCBiZVxuICAgKiBleGVjdXRlZCBpbiBvbmUgc2V0SW1tZWRpYXRlIGJhdGNoIChkZWZhdWx0KS5cbiAgICovXG4gIHNldERlYWRsaW5lKGRlYWRsaW5lOiBudW1iZXIpIHtcbiAgICBfZGVhZGxpbmUgPSBkZWFkbGluZTtcbiAgfSxcbn07XG5cbmNvbnN0IF9pbnRlcmFjdGlvblNldCA9IG5ldyBTZXQ8bnVtYmVyIHwgSGFuZGxlPigpO1xuY29uc3QgX2FkZEludGVyYWN0aW9uU2V0ID0gbmV3IFNldDxudW1iZXIgfCBIYW5kbGU+KCk7XG5jb25zdCBfZGVsZXRlSW50ZXJhY3Rpb25TZXQgPSBuZXcgU2V0PEhhbmRsZT4oKTtcbmNvbnN0IF90YXNrUXVldWUgPSBuZXcgVGFza1F1ZXVlKHtvbk1vcmVUYXNrczogX3NjaGVkdWxlVXBkYXRlfSk7XG5sZXQgX25leHRVcGRhdGVIYW5kbGU6ICRGbG93Rml4TWUgfCBUaW1lb3V0SUQgPSAwO1xubGV0IF9pbmMgPSAwO1xubGV0IF9kZWFkbGluZSA9IC0xO1xuXG4vKipcbiAqIFNjaGVkdWxlIGFuIGFzeW5jaHJvbm91cyB1cGRhdGUgdG8gdGhlIGludGVyYWN0aW9uIHN0YXRlLlxuICovXG5mdW5jdGlvbiBfc2NoZWR1bGVVcGRhdGUoKSB7XG4gIGlmICghX25leHRVcGRhdGVIYW5kbGUpIHtcbiAgICBpZiAoX2RlYWRsaW5lID4gMCkge1xuICAgICAgX25leHRVcGRhdGVIYW5kbGUgPSBzZXRUaW1lb3V0KF9wcm9jZXNzVXBkYXRlLCAwICsgREVCVUdfREVMQVkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBfbmV4dFVwZGF0ZUhhbmRsZSA9IHNldEltbWVkaWF0ZShfcHJvY2Vzc1VwZGF0ZSk7XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogTm90aWZ5IGxpc3RlbmVycywgcHJvY2VzcyBxdWV1ZSwgZXRjXG4gKi9cbmZ1bmN0aW9uIF9wcm9jZXNzVXBkYXRlKCkge1xuICBfbmV4dFVwZGF0ZUhhbmRsZSA9IDA7XG5cbiAgY29uc3QgaW50ZXJhY3Rpb25Db3VudCA9IF9pbnRlcmFjdGlvblNldC5zaXplO1xuICBfYWRkSW50ZXJhY3Rpb25TZXQuZm9yRWFjaChoYW5kbGUgPT4gX2ludGVyYWN0aW9uU2V0LmFkZChoYW5kbGUpKTtcbiAgX2RlbGV0ZUludGVyYWN0aW9uU2V0LmZvckVhY2goaGFuZGxlID0+IF9pbnRlcmFjdGlvblNldC5kZWxldGUoaGFuZGxlKSk7XG4gIGNvbnN0IG5leHRJbnRlcmFjdGlvbkNvdW50ID0gX2ludGVyYWN0aW9uU2V0LnNpemU7XG5cbiAgaWYgKGludGVyYWN0aW9uQ291bnQgIT09IDAgJiYgbmV4dEludGVyYWN0aW9uQ291bnQgPT09IDApIHtcbiAgICAvLyB0cmFuc2l0aW9uIGZyb20gMSsgLS0+IDAgaW50ZXJhY3Rpb25zXG4gICAgLyogJEZsb3dGaXhNZVtwcm9wLW1pc3NpbmddIE5hdHVyYWwgSW5mZXJlbmNlIHJvbGxvdXQuIFNlZVxuICAgICAqIGh0dHBzOi8vZmJ1cmwuY29tL3dvcmtwbGFjZS82MjkxZ2Z2dSAqL1xuICAgIC8qICRGbG93Rml4TWVbaW52YWxpZC1jb21wdXRlZC1wcm9wXSBOYXR1cmFsIEluZmVyZW5jZSByb2xsb3V0LiBTZWVcbiAgICAgKiBodHRwczovL2ZidXJsLmNvbS93b3JrcGxhY2UvNjI5MWdmdnUgKi9cbiAgICBfZW1pdHRlci5lbWl0KEludGVyYWN0aW9uTWFuYWdlci5FdmVudHMuaW50ZXJhY3Rpb25Db21wbGV0ZSk7XG4gIH0gZWxzZSBpZiAoaW50ZXJhY3Rpb25Db3VudCA9PT0gMCAmJiBuZXh0SW50ZXJhY3Rpb25Db3VudCAhPT0gMCkge1xuICAgIC8vIHRyYW5zaXRpb24gZnJvbSAwIC0tPiAxKyBpbnRlcmFjdGlvbnNcbiAgICAvKiAkRmxvd0ZpeE1lW3Byb3AtbWlzc2luZ10gTmF0dXJhbCBJbmZlcmVuY2Ugcm9sbG91dC4gU2VlXG4gICAgICogaHR0cHM6Ly9mYnVybC5jb20vd29ya3BsYWNlLzYyOTFnZnZ1ICovXG4gICAgLyogJEZsb3dGaXhNZVtpbnZhbGlkLWNvbXB1dGVkLXByb3BdIE5hdHVyYWwgSW5mZXJlbmNlIHJvbGxvdXQuIFNlZVxuICAgICAqIGh0dHBzOi8vZmJ1cmwuY29tL3dvcmtwbGFjZS82MjkxZ2Z2dSAqL1xuICAgIF9lbWl0dGVyLmVtaXQoSW50ZXJhY3Rpb25NYW5hZ2VyLkV2ZW50cy5pbnRlcmFjdGlvblN0YXJ0KTtcbiAgfVxuXG4gIC8vIHByb2Nlc3MgdGhlIHF1ZXVlIHJlZ2FyZGxlc3Mgb2YgYSB0cmFuc2l0aW9uXG4gIGlmIChuZXh0SW50ZXJhY3Rpb25Db3VudCA9PT0gMCkge1xuICAgIHdoaWxlIChfdGFza1F1ZXVlLmhhc1Rhc2tzVG9Qcm9jZXNzKCkpIHtcbiAgICAgIF90YXNrUXVldWUucHJvY2Vzc05leHQoKTtcbiAgICAgIGlmIChcbiAgICAgICAgX2RlYWRsaW5lID4gMCAmJlxuICAgICAgICBCYXRjaGVkQnJpZGdlLmdldEV2ZW50TG9vcFJ1bm5pbmdUaW1lKCkgPj0gX2RlYWRsaW5lXG4gICAgICApIHtcbiAgICAgICAgLy8gSGl0IGRlYWRsaW5lIGJlZm9yZSBwcm9jZXNzaW5nIGFsbCB0YXNrcywgc28gcHJvY2VzcyBtb3JlIGxhdGVyLlxuICAgICAgICBfc2NoZWR1bGVVcGRhdGUoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIF9hZGRJbnRlcmFjdGlvblNldC5jbGVhcigpO1xuICBfZGVsZXRlSW50ZXJhY3Rpb25TZXQuY2xlYXIoKTtcbn1cblxuLyoqXG4gKiBJbnRlcmFjdGlvbk1hbmFnZXIgYWxsb3dzIGxvbmctcnVubmluZyB3b3JrIHRvIGJlIHNjaGVkdWxlZCBhZnRlciBhbnlcbiAqIGludGVyYWN0aW9ucy9hbmltYXRpb25zIGhhdmUgY29tcGxldGVkLiBJbiBwYXJ0aWN1bGFyLCB0aGlzIGFsbG93cyBKYXZhU2NyaXB0XG4gKiBhbmltYXRpb25zIHRvIHJ1biBzbW9vdGhseS5cbiAqXG4gKiBBcHBsaWNhdGlvbnMgY2FuIHNjaGVkdWxlIHRhc2tzIHRvIHJ1biBhZnRlciBpbnRlcmFjdGlvbnMgd2l0aCB0aGUgZm9sbG93aW5nOlxuICpcbiAqIGBgYFxuICogSW50ZXJhY3Rpb25NYW5hZ2VyLnJ1bkFmdGVySW50ZXJhY3Rpb25zKCgpID0+IHtcbiAqICAgLy8gLi4ubG9uZy1ydW5uaW5nIHN5bmNocm9ub3VzIHRhc2suLi5cbiAqIH0pO1xuICogYGBgXG4gKlxuICogQ29tcGFyZSB0aGlzIHRvIG90aGVyIHNjaGVkdWxpbmcgYWx0ZXJuYXRpdmVzOlxuICpcbiAqIC0gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKCk6IGZvciBjb2RlIHRoYXQgYW5pbWF0ZXMgYSB2aWV3IG92ZXIgdGltZS5cbiAqIC0gc2V0SW1tZWRpYXRlL3NldFRpbWVvdXQoKTogcnVuIGNvZGUgbGF0ZXIsIG5vdGUgdGhpcyBtYXkgZGVsYXkgYW5pbWF0aW9ucy5cbiAqIC0gcnVuQWZ0ZXJJbnRlcmFjdGlvbnMoKTogcnVuIGNvZGUgbGF0ZXIsIHdpdGhvdXQgZGVsYXlpbmcgYWN0aXZlIGFuaW1hdGlvbnMuXG4gKlxuICogVGhlIHRvdWNoIGhhbmRsaW5nIHN5c3RlbSBjb25zaWRlcnMgb25lIG9yIG1vcmUgYWN0aXZlIHRvdWNoZXMgdG8gYmUgYW5cbiAqICdpbnRlcmFjdGlvbicgYW5kIHdpbGwgZGVsYXkgYHJ1bkFmdGVySW50ZXJhY3Rpb25zKClgIGNhbGxiYWNrcyB1bnRpbCBhbGxcbiAqIHRvdWNoZXMgaGF2ZSBlbmRlZCBvciBiZWVuIGNhbmNlbGxlZC5cbiAqXG4gKiBJbnRlcmFjdGlvbk1hbmFnZXIgYWxzbyBhbGxvd3MgYXBwbGljYXRpb25zIHRvIHJlZ2lzdGVyIGFuaW1hdGlvbnMgYnlcbiAqIGNyZWF0aW5nIGFuIGludGVyYWN0aW9uICdoYW5kbGUnIG9uIGFuaW1hdGlvbiBzdGFydCwgYW5kIGNsZWFyaW5nIGl0IHVwb25cbiAqIGNvbXBsZXRpb246XG4gKlxuICogYGBgXG4gKiB2YXIgaGFuZGxlID0gSW50ZXJhY3Rpb25NYW5hZ2VyLmNyZWF0ZUludGVyYWN0aW9uSGFuZGxlKCk7XG4gKiAvLyBydW4gYW5pbWF0aW9uLi4uIChgcnVuQWZ0ZXJJbnRlcmFjdGlvbnNgIHRhc2tzIGFyZSBxdWV1ZWQpXG4gKiAvLyBsYXRlciwgb24gYW5pbWF0aW9uIGNvbXBsZXRpb246XG4gKiBJbnRlcmFjdGlvbk1hbmFnZXIuY2xlYXJJbnRlcmFjdGlvbkhhbmRsZShoYW5kbGUpO1xuICogLy8gcXVldWVkIHRhc2tzIHJ1biBpZiBhbGwgaGFuZGxlcyB3ZXJlIGNsZWFyZWRcbiAqIGBgYFxuICpcbiAqIGBydW5BZnRlckludGVyYWN0aW9uc2AgdGFrZXMgZWl0aGVyIGEgcGxhaW4gY2FsbGJhY2sgZnVuY3Rpb24sIG9yIGFcbiAqIGBQcm9taXNlVGFza2Agb2JqZWN0IHdpdGggYSBgZ2VuYCBtZXRob2QgdGhhdCByZXR1cm5zIGEgYFByb21pc2VgLiAgSWYgYVxuICogYFByb21pc2VUYXNrYCBpcyBzdXBwbGllZCwgdGhlbiBpdCBpcyBmdWxseSByZXNvbHZlZCAoaW5jbHVkaW5nIGFzeW5jaHJvbm91c1xuICogZGVwZW5kZW5jaWVzIHRoYXQgYWxzbyBzY2hlZHVsZSBtb3JlIHRhc2tzIHZpYSBgcnVuQWZ0ZXJJbnRlcmFjdGlvbnNgKSBiZWZvcmVcbiAqIHN0YXJ0aW5nIG9uIHRoZSBuZXh0IHRhc2sgdGhhdCBtaWdodCBoYXZlIGJlZW4gcXVldWVkIHVwIHN5bmNocm9ub3VzbHlcbiAqIGVhcmxpZXIuXG4gKlxuICogQnkgZGVmYXVsdCwgcXVldWVkIHRhc2tzIGFyZSBleGVjdXRlZCB0b2dldGhlciBpbiBhIGxvb3AgaW4gb25lXG4gKiBgc2V0SW1tZWRpYXRlYCBiYXRjaC4gSWYgYHNldERlYWRsaW5lYCBpcyBjYWxsZWQgd2l0aCBhIHBvc2l0aXZlIG51bWJlciwgdGhlblxuICogdGFza3Mgd2lsbCBvbmx5IGJlIGV4ZWN1dGVkIHVudGlsIHRoZSBkZWFkbGluZSAoaW4gdGVybXMgb2YganMgZXZlbnQgbG9vcCBydW5cbiAqIHRpbWUpIGFwcHJvYWNoZXMsIGF0IHdoaWNoIHBvaW50IGV4ZWN1dGlvbiB3aWxsIHlpZWxkIHZpYSBzZXRUaW1lb3V0LFxuICogYWxsb3dpbmcgZXZlbnRzIHN1Y2ggYXMgdG91Y2hlcyB0byBzdGFydCBpbnRlcmFjdGlvbnMgYW5kIGJsb2NrIHF1ZXVlZCB0YXNrc1xuICogZnJvbSBleGVjdXRpbmcsIG1ha2luZyBhcHBzIG1vcmUgcmVzcG9uc2l2ZS5cbiAqXG4gKiBAZGVwcmVjYXRlZFxuICovXG5jb25zdCBJbnRlcmFjdGlvbk1hbmFnZXIgPSAoXG4gIFJlYWN0TmF0aXZlRmVhdHVyZUZsYWdzLmRpc2FibGVJbnRlcmFjdGlvbk1hbmFnZXIoKVxuICAgID8gLy8gJEZsb3dGaXhNZVtpbmNvbXBhdGlibGUtdmFyaWFuY2VdXG4gICAgICByZXF1aXJlKCcuL0ludGVyYWN0aW9uTWFuYWdlclN0dWInKS5kZWZhdWx0XG4gICAgOiBJbnRlcmFjdGlvbk1hbmFnZXJJbXBsXG4pIGFzIHR5cGVvZiBJbnRlcmFjdGlvbk1hbmFnZXJJbXBsO1xuXG5leHBvcnQgZGVmYXVsdCBJbnRlcmFjdGlvbk1hbmFnZXI7XG4iXSwibWFwcGluZ3MiOiI7Ozs7O0FBYUEsSUFBQUEsdUJBQUEsR0FBQUMsdUJBQUEsQ0FBQUMsT0FBQTtBQUNBLElBQUFDLGFBQUEsR0FBQUMsc0JBQUEsQ0FBQUYsT0FBQTtBQUEwRCxTQUFBRCx3QkFBQUksQ0FBQSxFQUFBQyxDQUFBLDZCQUFBQyxPQUFBLE1BQUFDLENBQUEsT0FBQUQsT0FBQSxJQUFBRSxDQUFBLE9BQUFGLE9BQUEsWUFBQU4sdUJBQUEsWUFBQUEsd0JBQUFJLENBQUEsRUFBQUMsQ0FBQSxTQUFBQSxDQUFBLElBQUFELENBQUEsSUFBQUEsQ0FBQSxDQUFBSyxVQUFBLFNBQUFMLENBQUEsTUFBQU0sQ0FBQSxFQUFBQyxDQUFBLEVBQUFDLENBQUEsS0FBQUMsU0FBQSxRQUFBQyxPQUFBLEVBQUFWLENBQUEsaUJBQUFBLENBQUEsdUJBQUFBLENBQUEseUJBQUFBLENBQUEsU0FBQVEsQ0FBQSxNQUFBRixDQUFBLEdBQUFMLENBQUEsR0FBQUcsQ0FBQSxHQUFBRCxDQUFBLFFBQUFHLENBQUEsQ0FBQUssR0FBQSxDQUFBWCxDQUFBLFVBQUFNLENBQUEsQ0FBQU0sR0FBQSxDQUFBWixDQUFBLEdBQUFNLENBQUEsQ0FBQU8sR0FBQSxDQUFBYixDQUFBLEVBQUFRLENBQUEsY0FBQU0sRUFBQSxJQUFBZCxDQUFBLGdCQUFBYyxFQUFBLE9BQUFDLGNBQUEsQ0FBQUMsSUFBQSxDQUFBaEIsQ0FBQSxFQUFBYyxFQUFBLE9BQUFQLENBQUEsSUFBQUQsQ0FBQSxHQUFBVyxNQUFBLENBQUFDLGNBQUEsS0FBQUQsTUFBQSxDQUFBRSx3QkFBQSxDQUFBbkIsQ0FBQSxFQUFBYyxFQUFBLE9BQUFQLENBQUEsQ0FBQUssR0FBQSxJQUFBTCxDQUFBLENBQUFNLEdBQUEsSUFBQVAsQ0FBQSxDQUFBRSxDQUFBLEVBQUFNLEVBQUEsRUFBQVAsQ0FBQSxJQUFBQyxDQUFBLENBQUFNLEVBQUEsSUFBQWQsQ0FBQSxDQUFBYyxFQUFBLFdBQUFOLENBQUEsS0FBQVIsQ0FBQSxFQUFBQyxDQUFBO0FBRTFELElBQU1tQixhQUFhLEdBQUd2QixPQUFPLENBQUMsZ0NBQWdDLENBQUMsQ0FBQ2EsT0FBTztBQUN2RSxJQUFNVyxTQUFTLEdBQUd4QixPQUFPLENBQUMsYUFBYSxDQUFDLENBQUNhLE9BQU87QUFDaEQsSUFBTVksU0FBUyxHQUFHekIsT0FBTyxDQUFDLFdBQVcsQ0FBQztBQU10QyxJQUFNMEIsUUFBUSxHQUFHLElBQUlDLHFCQUFZLENBRzlCLENBQUM7QUFFSixJQUFNQyxXQUFjLEdBQUcsQ0FBQztBQUN4QixJQUFNQyxLQUFZLEdBQUcsS0FBSztBQUUxQixJQUFNQyxzQkFBc0IsR0FBRztFQUM3QkMsTUFBTSxFQUFFO0lBQ05DLGdCQUFnQixFQUFFLGtCQUFrQjtJQUNwQ0MsbUJBQW1CLEVBQUU7RUFDdkIsQ0FBQztFQU1EQyxvQkFBb0IsV0FBcEJBLG9CQUFvQkEsQ0FBQ0MsSUFBVyxFQU85QjtJQUNBLElBQU1DLEtBQWtCLEdBQUcsRUFBRTtJQUM3QixJQUFNQyxPQUFPLEdBQUcsSUFBSUMsT0FBTyxDQUFDLFVBQUNDLE9BQW1CLEVBQUs7TUFDbkRDLGVBQWUsQ0FBQyxDQUFDO01BQ2pCLElBQUlMLElBQUksRUFBRTtRQUNSQyxLQUFLLENBQUNLLElBQUksQ0FBQ04sSUFBSSxDQUFDO01BQ2xCO01BQ0FDLEtBQUssQ0FBQ0ssSUFBSSxDQUFDO1FBQ1RDLEdBQUcsRUFBRUgsT0FBTztRQUNaSSxJQUFJLEVBQUUsVUFBVSxJQUFLUixJQUFJLElBQUlBLElBQUksQ0FBQ1EsSUFBSSxJQUFLLEdBQUc7TUFDaEQsQ0FBQyxDQUFDO01BQ0ZDLFVBQVUsQ0FBQ0MsWUFBWSxDQUFDVCxLQUFLLENBQUM7SUFDaEMsQ0FBQyxDQUFDO0lBQ0YsT0FBTztNQUVMVSxJQUFJLEVBQUVULE9BQU8sQ0FBQ1MsSUFBSSxDQUFDQyxJQUFJLENBQUNWLE9BQU8sQ0FBQztNQUNoQ1csTUFBTSxFQUFFLFNBQVJBLE1BQU1BLENBQUEsRUFBYztRQUNsQkosVUFBVSxDQUFDSyxXQUFXLENBQUNiLEtBQUssQ0FBQztNQUMvQjtJQUNGLENBQUM7RUFDSCxDQUFDO0VBS0RjLHVCQUF1QixXQUF2QkEsdUJBQXVCQSxDQUFBLEVBQVc7SUFDaENyQixLQUFLLElBQUlzQixPQUFPLENBQUNDLEdBQUcsQ0FBQywrQ0FBK0MsQ0FBQztJQUNyRVosZUFBZSxDQUFDLENBQUM7SUFDakIsSUFBTWEsTUFBTSxHQUFHLEVBQUVDLElBQUk7SUFDckJDLGtCQUFrQixDQUFDQyxHQUFHLENBQUNILE1BQU0sQ0FBQztJQUM5QixPQUFPQSxNQUFNO0VBQ2YsQ0FBQztFQUtESSxzQkFBc0IsV0FBdEJBLHNCQUFzQkEsQ0FBQ0osTUFBYyxFQUFFO0lBQ3JDeEIsS0FBSyxJQUFJc0IsT0FBTyxDQUFDQyxHQUFHLENBQUMsOENBQThDLENBQUM7SUFDcEUzQixTQUFTLENBQUMsQ0FBQyxDQUFDNEIsTUFBTSxFQUFFLHFEQUFxRCxDQUFDO0lBQzFFYixlQUFlLENBQUMsQ0FBQztJQUNqQmUsa0JBQWtCLENBQUNHLE1BQU0sQ0FBQ0wsTUFBTSxDQUFDO0lBQ2pDTSxxQkFBcUIsQ0FBQ0gsR0FBRyxDQUFDSCxNQUFNLENBQUM7RUFDbkMsQ0FBQztFQUlETyxXQUFXLEVBQUVsQyxRQUFRLENBQUNrQyxXQUFXLENBQUNiLElBQUksQ0FBQ3JCLFFBQVEsQ0FLekI7RUFPdEJtQyxXQUFXLFdBQVhBLFdBQVdBLENBQUNDLFFBQWdCLEVBQUU7SUFDNUJDLFNBQVMsR0FBR0QsUUFBUTtFQUN0QjtBQUNGLENBQUM7QUFFRCxJQUFNRSxlQUFlLEdBQUcsSUFBSUMsR0FBRyxDQUFrQixDQUFDO0FBQ2xELElBQU1WLGtCQUFrQixHQUFHLElBQUlVLEdBQUcsQ0FBa0IsQ0FBQztBQUNyRCxJQUFNTixxQkFBcUIsR0FBRyxJQUFJTSxHQUFHLENBQVMsQ0FBQztBQUMvQyxJQUFNckIsVUFBVSxHQUFHLElBQUlwQixTQUFTLENBQUM7RUFBQzBDLFdBQVcsRUFBRTFCO0FBQWUsQ0FBQyxDQUFDO0FBQ2hFLElBQUkyQixpQkFBeUMsR0FBRyxDQUFDO0FBQ2pELElBQUliLElBQUksR0FBRyxDQUFDO0FBQ1osSUFBSVMsU0FBUyxHQUFHLENBQUMsQ0FBQztBQUtsQixTQUFTdkIsZUFBZUEsQ0FBQSxFQUFHO0VBQ3pCLElBQUksQ0FBQzJCLGlCQUFpQixFQUFFO0lBQ3RCLElBQUlKLFNBQVMsR0FBRyxDQUFDLEVBQUU7TUFDakJJLGlCQUFpQixHQUFHQyxVQUFVLENBQUNDLGNBQWMsRUFBRSxDQUFDLEdBQUd6QyxXQUFXLENBQUM7SUFDakUsQ0FBQyxNQUFNO01BQ0x1QyxpQkFBaUIsR0FBR0csWUFBWSxDQUFDRCxjQUFjLENBQUM7SUFDbEQ7RUFDRjtBQUNGO0FBS0EsU0FBU0EsY0FBY0EsQ0FBQSxFQUFHO0VBQ3hCRixpQkFBaUIsR0FBRyxDQUFDO0VBRXJCLElBQU1JLGdCQUFnQixHQUFHUCxlQUFlLENBQUNRLElBQUk7RUFDN0NqQixrQkFBa0IsQ0FBQ2tCLE9BQU8sQ0FBQyxVQUFBcEIsTUFBTTtJQUFBLE9BQUlXLGVBQWUsQ0FBQ1IsR0FBRyxDQUFDSCxNQUFNLENBQUM7RUFBQSxFQUFDO0VBQ2pFTSxxQkFBcUIsQ0FBQ2MsT0FBTyxDQUFDLFVBQUFwQixNQUFNO0lBQUEsT0FBSVcsZUFBZSxDQUFDTixNQUFNLENBQUNMLE1BQU0sQ0FBQztFQUFBLEVBQUM7RUFDdkUsSUFBTXFCLG9CQUFvQixHQUFHVixlQUFlLENBQUNRLElBQUk7RUFFakQsSUFBSUQsZ0JBQWdCLEtBQUssQ0FBQyxJQUFJRyxvQkFBb0IsS0FBSyxDQUFDLEVBQUU7SUFNeERoRCxRQUFRLENBQUNpRCxJQUFJLENBQUNDLGtCQUFrQixDQUFDN0MsTUFBTSxDQUFDRSxtQkFBbUIsQ0FBQztFQUM5RCxDQUFDLE1BQU0sSUFBSXNDLGdCQUFnQixLQUFLLENBQUMsSUFBSUcsb0JBQW9CLEtBQUssQ0FBQyxFQUFFO0lBTS9EaEQsUUFBUSxDQUFDaUQsSUFBSSxDQUFDQyxrQkFBa0IsQ0FBQzdDLE1BQU0sQ0FBQ0MsZ0JBQWdCLENBQUM7RUFDM0Q7RUFHQSxJQUFJMEMsb0JBQW9CLEtBQUssQ0FBQyxFQUFFO0lBQzlCLE9BQU85QixVQUFVLENBQUNpQyxpQkFBaUIsQ0FBQyxDQUFDLEVBQUU7TUFDckNqQyxVQUFVLENBQUNrQyxXQUFXLENBQUMsQ0FBQztNQUN4QixJQUNFZixTQUFTLEdBQUcsQ0FBQyxJQUNieEMsYUFBYSxDQUFDd0QsdUJBQXVCLENBQUMsQ0FBQyxJQUFJaEIsU0FBUyxFQUNwRDtRQUVBdkIsZUFBZSxDQUFDLENBQUM7UUFDakI7TUFDRjtJQUNGO0VBQ0Y7RUFDQWUsa0JBQWtCLENBQUN5QixLQUFLLENBQUMsQ0FBQztFQUMxQnJCLHFCQUFxQixDQUFDcUIsS0FBSyxDQUFDLENBQUM7QUFDL0I7QUFxREEsSUFBTUosa0JBQWtCLEdBQ3RCOUUsdUJBQXVCLENBQUNtRix5QkFBeUIsQ0FBQyxDQUFDLEdBRS9DakYsT0FBTyxDQUFDLDBCQUEwQixDQUFDLENBQUNhLE9BQU8sR0FDM0NpQixzQkFDNEI7QUFBQyxJQUFBb0QsUUFBQSxHQUFBQyxPQUFBLENBQUF0RSxPQUFBLEdBRXBCK0Qsa0JBQWtCIiwiaWdub3JlTGlzdCI6W119