b8a3a54982f2be4aa801628c27972207
"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.PreventRemoveProvider = PreventRemoveProvider;
var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));
var _toConsumableArray2 = _interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));
var _nonSecure = require("nanoid/non-secure");
var React = _interopRequireWildcard(require("react"));
var _useLatestCallback = _interopRequireDefault(require("use-latest-callback"));
var _NavigationHelpersContext = require("./NavigationHelpersContext.js");
var _NavigationRouteContext = require("./NavigationRouteContext.js");
var _PreventRemoveContext = require("./PreventRemoveContext.js");
var _jsxRuntime = require("react/jsx-runtime");
function _interopRequireWildcard(e, t) { if ("function" == typeof WeakMap) var r = new WeakMap(), n = new WeakMap(); return (_interopRequireWildcard = function _interopRequireWildcard(e, t) { if (!t && e && e.__esModule) return e; var o, i, f = { __proto__: null, default: e }; if (null === e || "object" != typeof e && "function" != typeof e) return f; if (o = t ? n : r) { if (o.has(e)) return o.get(e); o.set(e, f); } for (var _t in e) "default" !== _t && {}.hasOwnProperty.call(e, _t) && ((i = (o = Object.defineProperty) && Object.getOwnPropertyDescriptor(e, _t)) && (i.get || i.set) ? o(f, _t, i) : f[_t] = e[_t]); return f; })(e, t); }
var transformPreventedRoutes = function transformPreventedRoutes(preventedRoutesMap) {
  var preventedRoutesToTransform = (0, _toConsumableArray2.default)(preventedRoutesMap.values());
  var preventedRoutes = preventedRoutesToTransform.reduce(function (acc, _ref) {
    var _acc$routeKey;
    var routeKey = _ref.routeKey,
      preventRemove = _ref.preventRemove;
    acc[routeKey] = {
      preventRemove: ((_acc$routeKey = acc[routeKey]) == null ? void 0 : _acc$routeKey.preventRemove) || preventRemove
    };
    return acc;
  }, {});
  return preventedRoutes;
};
function PreventRemoveProvider(_ref2) {
  var children = _ref2.children;
  var _React$useState = React.useState(function () {
      return (0, _nonSecure.nanoid)();
    }),
    _React$useState2 = (0, _slicedToArray2.default)(_React$useState, 1),
    parentId = _React$useState2[0];
  var _React$useState3 = React.useState(function () {
      return new Map();
    }),
    _React$useState4 = (0, _slicedToArray2.default)(_React$useState3, 2),
    preventedRoutesMap = _React$useState4[0],
    setPreventedRoutesMap = _React$useState4[1];
  var navigation = React.useContext(_NavigationHelpersContext.NavigationHelpersContext);
  var route = React.useContext(_NavigationRouteContext.NavigationRouteContext);
  var preventRemoveContextValue = React.useContext(_PreventRemoveContext.PreventRemoveContext);
  var setParentPrevented = preventRemoveContextValue == null ? void 0 : preventRemoveContextValue.setPreventRemove;
  var setPreventRemove = (0, _useLatestCallback.default)(function (id, routeKey, preventRemove) {
    if (preventRemove && (navigation == null || navigation != null && navigation.getState().routes.every(function (route) {
      return route.key !== routeKey;
    }))) {
      throw new Error(`Couldn't find a route with the key ${routeKey}. Is your component inside NavigationContent?`);
    }
    setPreventedRoutesMap(function (prevPrevented) {
      var _prevPrevented$get, _prevPrevented$get2;
      if (routeKey === ((_prevPrevented$get = prevPrevented.get(id)) == null ? void 0 : _prevPrevented$get.routeKey) && preventRemove === ((_prevPrevented$get2 = prevPrevented.get(id)) == null ? void 0 : _prevPrevented$get2.preventRemove)) {
        return prevPrevented;
      }
      var nextPrevented = new Map(prevPrevented);
      if (preventRemove) {
        nextPrevented.set(id, {
          routeKey: routeKey,
          preventRemove: preventRemove
        });
      } else {
        nextPrevented.delete(id);
      }
      return nextPrevented;
    });
  });
  var isPrevented = (0, _toConsumableArray2.default)(preventedRoutesMap.values()).some(function (_ref3) {
    var preventRemove = _ref3.preventRemove;
    return preventRemove;
  });
  React.useEffect(function () {
    if ((route == null ? void 0 : route.key) !== undefined && setParentPrevented !== undefined) {
      setParentPrevented(parentId, route.key, isPrevented);
      return function () {
        setParentPrevented(parentId, route.key, false);
      };
    }
    return;
  }, [parentId, isPrevented, route == null ? void 0 : route.key, setParentPrevented]);
  var value = React.useMemo(function () {
    return {
      setPreventRemove: setPreventRemove,
      preventedRoutes: transformPreventedRoutes(preventedRoutesMap)
    };
  }, [setPreventRemove, preventedRoutesMap]);
  return (0, _jsxRuntime.jsx)(_PreventRemoveContext.PreventRemoveContext.Provider, {
    value: value,
    children: children
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfbm9uU2VjdXJlIiwicmVxdWlyZSIsIlJlYWN0IiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJfdXNlTGF0ZXN0Q2FsbGJhY2siLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwiX05hdmlnYXRpb25IZWxwZXJzQ29udGV4dCIsIl9OYXZpZ2F0aW9uUm91dGVDb250ZXh0IiwiX1ByZXZlbnRSZW1vdmVDb250ZXh0IiwiX2pzeFJ1bnRpbWUiLCJlIiwidCIsIldlYWtNYXAiLCJyIiwibiIsIl9fZXNNb2R1bGUiLCJvIiwiaSIsImYiLCJfX3Byb3RvX18iLCJkZWZhdWx0IiwiaGFzIiwiZ2V0Iiwic2V0IiwiX3QiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsInRyYW5zZm9ybVByZXZlbnRlZFJvdXRlcyIsInByZXZlbnRlZFJvdXRlc01hcCIsInByZXZlbnRlZFJvdXRlc1RvVHJhbnNmb3JtIiwiX3RvQ29uc3VtYWJsZUFycmF5MiIsInZhbHVlcyIsInByZXZlbnRlZFJvdXRlcyIsInJlZHVjZSIsImFjYyIsIl9yZWYiLCJfYWNjJHJvdXRlS2V5Iiwicm91dGVLZXkiLCJwcmV2ZW50UmVtb3ZlIiwiUHJldmVudFJlbW92ZVByb3ZpZGVyIiwiX3JlZjIiLCJjaGlsZHJlbiIsIl9SZWFjdCR1c2VTdGF0ZSIsInVzZVN0YXRlIiwibmFub2lkIiwiX1JlYWN0JHVzZVN0YXRlMiIsIl9zbGljZWRUb0FycmF5MiIsInBhcmVudElkIiwiX1JlYWN0JHVzZVN0YXRlMyIsIk1hcCIsIl9SZWFjdCR1c2VTdGF0ZTQiLCJzZXRQcmV2ZW50ZWRSb3V0ZXNNYXAiLCJuYXZpZ2F0aW9uIiwidXNlQ29udGV4dCIsIk5hdmlnYXRpb25IZWxwZXJzQ29udGV4dCIsInJvdXRlIiwiTmF2aWdhdGlvblJvdXRlQ29udGV4dCIsInByZXZlbnRSZW1vdmVDb250ZXh0VmFsdWUiLCJQcmV2ZW50UmVtb3ZlQ29udGV4dCIsInNldFBhcmVudFByZXZlbnRlZCIsInNldFByZXZlbnRSZW1vdmUiLCJ1c2VMYXRlc3RDYWxsYmFjayIsImlkIiwiZ2V0U3RhdGUiLCJyb3V0ZXMiLCJldmVyeSIsImtleSIsIkVycm9yIiwicHJldlByZXZlbnRlZCIsIl9wcmV2UHJldmVudGVkJGdldCIsIl9wcmV2UHJldmVudGVkJGdldDIiLCJuZXh0UHJldmVudGVkIiwiZGVsZXRlIiwiaXNQcmV2ZW50ZWQiLCJzb21lIiwiX3JlZjMiLCJ1c2VFZmZlY3QiLCJ1bmRlZmluZWQiLCJ2YWx1ZSIsInVzZU1lbW8iLCJfanN4IiwiUHJvdmlkZXIiXSwic291cmNlcyI6WyIuLi8uLi9zcmMvUHJldmVudFJlbW92ZVByb3ZpZGVyLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6W251bGxdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsSUFBQUEsVUFBQSxHQUFBQyxPQUFBO0FBQ0EsSUFBQUMsS0FBQSxHQUFBQyx1QkFBQSxDQUFBRixPQUFBO0FBQ0EsSUFBQUcsa0JBQUEsR0FBQUMsc0JBQUEsQ0FBQUosT0FBQTtBQUVBLElBQUFLLHlCQUFBLEdBQUFMLE9BQUE7QUFDQSxJQUFBTSx1QkFBQSxHQUFBTixPQUFBO0FBQ0EsSUFBQU8scUJBQUEsR0FBQVAsT0FBQTtBQUdnQyxJQUFBUSxXQUFBLEdBQUFSLE9BQUE7QUFBQSxTQUFBRSx3QkFBQU8sQ0FBQSxFQUFBQyxDQUFBLDZCQUFBQyxPQUFBLE1BQUFDLENBQUEsT0FBQUQsT0FBQSxJQUFBRSxDQUFBLE9BQUFGLE9BQUEsWUFBQVQsdUJBQUEsWUFBQUEsd0JBQUFPLENBQUEsRUFBQUMsQ0FBQSxTQUFBQSxDQUFBLElBQUFELENBQUEsSUFBQUEsQ0FBQSxDQUFBSyxVQUFBLFNBQUFMLENBQUEsTUFBQU0sQ0FBQSxFQUFBQyxDQUFBLEVBQUFDLENBQUEsS0FBQUMsU0FBQSxRQUFBQyxPQUFBLEVBQUFWLENBQUEsaUJBQUFBLENBQUEsdUJBQUFBLENBQUEseUJBQUFBLENBQUEsU0FB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